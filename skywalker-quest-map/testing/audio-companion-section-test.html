<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Companion Section - Custom Test</title>
  <link rel="stylesheet" href="audio-companion-section-test.css">
</head>
<body>
  <section class="audio-companion-section">
    <div class="professor-voice-container">
      <div class="animated-border"></div>
      <div class="audio-content">
        <h3 class="gradient-text">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="url(#podcast-gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="podcast-icon">
            <defs>
              <linearGradient id="podcast-gradient" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#a259ff"/>
                <stop offset="100%" stop-color="#FFC107"/>
              </linearGradient>
            </defs>
            <path d="M16.85 18.58a9 9 0 1 0-9.7 0"/>
            <path d="M8 14a5 5 0 1 1 8 0"/>
            <circle cx="12" cy="11" r="1"/>
            <path d="M13 17a1 1 0 1 0-2 0l.5 4.5a.5.5 0 1 0 1 0Z"/>
          </svg>
          Audio Companion
        </h3>
        <p>
          Begin your journey with this in-depth exploration of Luke Skywalker's archetypal path. 
          This podcast episode provides the mythological foundation that underlies the entire quest map.
        </p>
        <div class="custom-audio-player">
          <div class="audio-info">
            <span class="audio-title">Luke Skywalker: A New Hope's Archetypal Journey</span>
            <span class="audio-duration" id="totalDuration">Full Episode</span>
          </div>
          
          <!-- Custom Audio Controls -->
          <div class="audio-controls">
            <button class="control-btn play-pause-btn" id="playPauseBtn" aria-label="Play">
              <svg class="play-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
              <svg class="pause-icon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
              </svg>
            </button>
            
            <div class="timeline-container">
              <div class="timeline-track">
                <div class="timeline-progress" id="timelineProgress"></div>
                <div class="timeline-handle" id="timelineHandle"></div>
              </div>
              <input type="range" class="timeline-slider" id="timelineSlider" min="0" max="100" value="0" step="0.1" aria-label="Seek timeline">
            </div>
            
            <div class="time-display">
              <span class="current-time" id="currentTime">0:00</span>
              <span class="time-separator">/</span>
              <span class="total-time" id="totalTime">0:00</span>
            </div>
            
            <div class="volume-control">
              <button class="control-btn volume-btn" id="volumeBtn" aria-label="Mute">
                <svg class="volume-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
                <svg class="mute-icon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                  <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
                </svg>
              </button>
              <div class="volume-slider-container" style="display: none;">
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1" aria-label="Volume">
              </div>
            </div>
            
            <button class="control-btn options-btn" id="optionsBtn" aria-label="More options">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
              </svg>
            </button>
          </div>
          
          <!-- Hidden native audio element -->
          <audio id="heroJourneyPodcast" preload="auto" style="display: none;">
            <source src="../Podcast Audio/Luke Skywalker_ A New Hope's Archetypal Journey.wav" type="audio/wav">
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
            <p>Your browser doesn't support audio. <a href="../Podcast Audio/Luke Skywalker_ A New Hope's Archetypal Journey.wav" download>Download the podcast</a></p>
          </audio>
        </div>
      </div>
    </div>
  </section>
  <script>
    const audio = document.getElementById('heroJourneyPodcast');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playIcon = document.querySelector('.play-icon');
    const pauseIcon = document.querySelector('.pause-icon');
    const timelineSlider = document.getElementById('timelineSlider');
    const timelineProgress = document.getElementById('timelineProgress');
    const timelineHandle = document.getElementById('timelineHandle');
    const currentTimeEl = document.getElementById('currentTime');
    const totalTimeEl = document.getElementById('totalTime');
    const totalDurationEl = document.getElementById('totalDuration');
    const volumeBtn = document.getElementById('volumeBtn');
    const volumeIcon = document.querySelector('.volume-icon');
    const muteIcon = document.querySelector('.mute-icon');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeContainer = document.querySelector('.volume-slider-container');

    let isDragging = false;
    let wasPlaying = false;

    function formatTime(sec) {
      if (isNaN(sec)) return '0:00';
      sec = Math.floor(sec);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    function updateProgress() {
      if (!isDragging && audio.duration) {
        const percent = (audio.currentTime / audio.duration) * 100;
        timelineProgress.style.width = percent + '%';
        timelineHandle.style.left = percent + '%';
        timelineSlider.value = audio.currentTime;
        currentTimeEl.textContent = formatTime(audio.currentTime);
      }
    }

    function togglePlayPause() {
      if (audio.paused) {
        audio.play();
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
        playPauseBtn.setAttribute('aria-label', 'Pause');
      } else {
        audio.pause();
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
        playPauseBtn.setAttribute('aria-label', 'Play');
      }
    }

    function toggleMute() {
      if (audio.muted) {
        audio.muted = false;
        volumeIcon.style.display = 'block';
        muteIcon.style.display = 'none';
        volumeBtn.setAttribute('aria-label', 'Mute');
      } else {
        audio.muted = true;
        volumeIcon.style.display = 'none';
        muteIcon.style.display = 'block';
        volumeBtn.setAttribute('aria-label', 'Unmute');
      }
    }

    // Add fallback for when duration isn't immediately available
    function checkAndSetDuration() {
      if (audio.duration && !isNaN(audio.duration) && isFinite(audio.duration)) {
        timelineSlider.max = audio.duration;
        totalTimeEl.textContent = formatTime(audio.duration);
        totalDurationEl.textContent = `Full Episode`;
        return true;
      }
      return false;
    }

    // Try to get duration periodically until it's available
    function waitForDuration() {
      if (!checkAndSetDuration()) {
        setTimeout(waitForDuration, 100);
      }
    }

    // Event Listeners
    audio.addEventListener('loadedmetadata', () => {
      checkAndSetDuration();
    });

    audio.addEventListener('loadeddata', () => {
      checkAndSetDuration();
    });

    audio.addEventListener('canplaythrough', () => {
      checkAndSetDuration();
    });

    audio.addEventListener('durationchange', () => {
      checkAndSetDuration();
    });

    // Start checking for duration immediately
    setTimeout(waitForDuration, 100);

    audio.addEventListener('timeupdate', updateProgress);

    audio.addEventListener('play', () => {
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'block';
      playPauseBtn.setAttribute('aria-label', 'Pause');
    });

    audio.addEventListener('pause', () => {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
      playPauseBtn.setAttribute('aria-label', 'Play');
    });

    audio.addEventListener('ended', () => {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
      playPauseBtn.setAttribute('aria-label', 'Play');
      timelineProgress.style.width = '0%';
      timelineHandle.style.left = '0%';
      currentTimeEl.textContent = '0:00';
    });

    playPauseBtn.addEventListener('click', togglePlayPause);

    timelineSlider.addEventListener('mousedown', (e) => {
      isDragging = true;
      wasPlaying = !audio.paused;
      audio.pause();
      
      // Immediately update position on mousedown
      const rect = timelineSlider.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const newTime = (clickX / rect.width) * audio.duration;
      audio.currentTime = Math.max(0, Math.min(audio.duration, newTime));
      timelineSlider.value = audio.currentTime;
    });

    timelineSlider.addEventListener('mousemove', (e) => {
      if (isDragging) {
        const rect = timelineSlider.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const newTime = (clickX / rect.width) * audio.duration;
        const clampedTime = Math.max(0, Math.min(audio.duration, newTime));
        
        audio.currentTime = clampedTime;
        timelineSlider.value = clampedTime;
        
        const percent = (clampedTime / audio.duration) * 100;
        timelineProgress.style.width = percent + '%';
        timelineHandle.style.left = percent + '%';
        currentTimeEl.textContent = formatTime(clampedTime);
      }
    });

    timelineSlider.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        if (wasPlaying) {
          audio.play();
        }
      }
    });

    // Handle click-to-seek without dragging
    timelineSlider.addEventListener('click', (e) => {
      if (!isDragging) {
        const rect = timelineSlider.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const newTime = (clickX / rect.width) * audio.duration;
        audio.currentTime = Math.max(0, Math.min(audio.duration, newTime));
        timelineSlider.value = audio.currentTime;
      }
    });

    timelineSlider.addEventListener('input', (e) => {
      if (!isDragging) {
        const newTime = parseFloat(e.target.value);
        audio.currentTime = newTime;
        
        const percent = (newTime / audio.duration) * 100;
        timelineProgress.style.width = percent + '%';
        timelineHandle.style.left = percent + '%';
        currentTimeEl.textContent = formatTime(newTime);
      }
    });

    volumeBtn.addEventListener('click', toggleMute);

    volumeBtn.addEventListener('mouseenter', () => {
      volumeContainer.style.display = 'block';
    });

    document.querySelector('.volume-control').addEventListener('mouseleave', () => {
      volumeContainer.style.display = 'none';
    });

    volumeSlider.addEventListener('input', (e) => {
      audio.volume = e.target.value;
      if (audio.volume === 0) {
        volumeIcon.style.display = 'none';
        muteIcon.style.display = 'block';
      } else {
        volumeIcon.style.display = 'block';
        muteIcon.style.display = 'none';
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName.toLowerCase() === 'input') return;
      
      switch(e.code) {
        case 'Space':
          e.preventDefault();
          togglePlayPause();
          break;
        case 'KeyM':
          toggleMute();
          break;
        case 'ArrowLeft':
          audio.currentTime = Math.max(0, audio.currentTime - 10);
          break;
        case 'ArrowRight':
          audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
          break;
      }
    });
  </script>
</body>
</html>
